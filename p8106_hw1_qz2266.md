p8106_hw1_qz2266
================
Qing Zhou
2023-02-21

### Data Import and cleaning

In this exercise, we predict the sale price of a house using its other
characteristics. The training data are in “housing train.csv”, and the
test data are in “housing test.csv”.

``` r
# read in training data
train = read.csv("data/housing_training.csv") %>% 
janitor::clean_names()
train = na.omit(train)

# read in test data
test = read.csv("data/housing_test.csv") %>% 
janitor::clean_names()
test = na.omit(test)

# create covariates matrix for training and test
x_train = model.matrix(sale_price ~ ., train)[,-1]
y_train = train$sale_price
x_test <- model.matrix(sale_price ~ ., test)[ ,-1]
y_test <- test$sale_price
```

### Fit a linear model using least squares

``` r
set.seed(1234)

lm_fit = lm(sale_price ~ ., 
            data = train,
            method = "lm",
            trControl = trainControl(method = "repeatedcv", number = 10, repeats = 5))
summary(lm_fit)
```

    ## 
    ## Call:
    ## lm(formula = sale_price ~ ., data = train, method = "lm", trControl = trainControl(method = "repeatedcv", 
    ##     number = 10, repeats = 5))
    ## 
    ## Residuals:
    ##    Min     1Q Median     3Q    Max 
    ## -89864 -12424    416  12143 140205 
    ## 
    ## Coefficients: (1 not defined because of singularities)
    ##                              Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)                -4.985e+06  3.035e+06  -1.642  0.10076    
    ## gr_liv_area                 2.458e+01  1.393e+01   1.765  0.07778 .  
    ## first_flr_sf                4.252e+01  1.409e+01   3.017  0.00260 ** 
    ## second_flr_sf               4.177e+01  1.379e+01   3.029  0.00250 ** 
    ## total_bsmt_sf               3.519e+01  2.744e+00  12.827  < 2e-16 ***
    ## low_qual_fin_sf                    NA         NA      NA       NA    
    ## wood_deck_sf                1.202e+01  4.861e+00   2.474  0.01350 *  
    ## open_porch_sf               1.618e+01  1.004e+01   1.611  0.10736    
    ## bsmt_unf_sf                -2.087e+01  1.723e+00 -12.116  < 2e-16 ***
    ## mas_vnr_area                1.046e+01  4.229e+00   2.473  0.01353 *  
    ## garage_cars                 4.229e+03  1.893e+03   2.234  0.02563 *  
    ## garage_area                 7.769e+00  6.497e+00   1.196  0.23195    
    ## year_built                  3.251e+02  3.130e+01  10.388  < 2e-16 ***
    ## tot_rms_abv_grd            -3.838e+03  6.922e+02  -5.545 3.51e-08 ***
    ## full_bath                  -4.341e+03  1.655e+03  -2.622  0.00883 ** 
    ## overall_qualAverage        -5.013e+03  1.735e+03  -2.890  0.00391 ** 
    ## overall_qualBelow_Average  -1.280e+04  2.677e+03  -4.782 1.92e-06 ***
    ## overall_qualExcellent       7.261e+04  5.381e+03  13.494  < 2e-16 ***
    ## overall_qualFair           -1.115e+04  5.240e+03  -2.127  0.03356 *  
    ## overall_qualGood            1.226e+04  1.950e+03   6.287 4.30e-10 ***
    ## overall_qualVery_Excellent  1.304e+05  8.803e+03  14.810  < 2e-16 ***
    ## overall_qualVery_Good       3.798e+04  2.741e+03  13.852  < 2e-16 ***
    ## kitchen_qualFair           -2.663e+04  6.325e+03  -4.210 2.71e-05 ***
    ## kitchen_qualGood           -1.879e+04  4.100e+03  -4.582 5.01e-06 ***
    ## kitchen_qualTypical        -2.677e+04  4.281e+03  -6.252 5.37e-10 ***
    ## fireplaces                  1.138e+04  2.257e+03   5.043 5.18e-07 ***
    ## fireplace_quFair           -7.207e+03  6.823e+03  -1.056  0.29106    
    ## fireplace_quGood            6.070e+02  5.833e+03   0.104  0.91713    
    ## fireplace_quNo_Fireplace    3.394e+03  6.298e+03   0.539  0.59002    
    ## fireplace_quPoor           -5.185e+03  7.399e+03  -0.701  0.48362    
    ## fireplace_quTypical        -6.398e+03  5.897e+03  -1.085  0.27814    
    ## exter_qualFair             -3.854e+04  8.383e+03  -4.598 4.66e-06 ***
    ## exter_qualGood             -1.994e+04  5.585e+03  -3.569  0.00037 ***
    ## exter_qualTypical          -2.436e+04  5.874e+03  -4.147 3.57e-05 ***
    ## lot_frontage                1.024e+02  1.905e+01   5.376 8.90e-08 ***
    ## lot_area                    6.042e-01  7.864e-02   7.683 2.91e-14 ***
    ## longitude                  -3.481e+04  2.537e+04  -1.372  0.17016    
    ## latitude                    5.874e+04  3.483e+04   1.686  0.09193 .  
    ## misc_val                    9.171e-01  1.003e+00   0.914  0.36071    
    ## year_sold                  -6.455e+02  4.606e+02  -1.401  0.16132    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 22190 on 1401 degrees of freedom
    ## Multiple R-squared:  0.9116, Adjusted R-squared:  0.9092 
    ## F-statistic: 380.3 on 38 and 1401 DF,  p-value: < 2.2e-16

### Fit a lasso model

#### using glmnet

``` r
set.seed(1234)

lasso_fit = cv.glmnet(
x = x_train,
y = y_train,
alpha = 1,
lambda = exp(seq(8, -5, length = 100))
)

plot(lasso_fit)
```

![](p8106_hw1_qz2266_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

``` r
# Look at the 1SE coefficient for lasso
predict(lasso_fit, s = lasso_fit$lambda.1se,type = "coefficients")
```

    ## 40 x 1 sparse Matrix of class "dgCMatrix"
    ##                                       s1
    ## (Intercept)                -2.356640e+06
    ## gr_liv_area                 5.689251e+01
    ## first_flr_sf                1.092418e+00
    ## second_flr_sf               .           
    ## total_bsmt_sf               3.679694e+01
    ## low_qual_fin_sf            -2.654011e+01
    ## wood_deck_sf                8.364371e+00
    ## open_porch_sf               8.061057e+00
    ## bsmt_unf_sf                -1.956245e+01
    ## mas_vnr_area                1.420896e+01
    ## garage_cars                 3.052107e+03
    ## garage_area                 1.134221e+01
    ## year_built                  3.130505e+02
    ## tot_rms_abv_grd            -1.318606e+03
    ## full_bath                   .           
    ## overall_qualAverage        -3.091008e+03
    ## overall_qualBelow_Average  -9.149605e+03
    ## overall_qualExcellent       9.036702e+04
    ## overall_qualFair           -6.352299e+03
    ## overall_qualGood            9.891546e+03
    ## overall_qualVery_Excellent  1.602754e+05
    ## overall_qualVery_Good       3.617500e+04
    ## kitchen_qualFair           -5.287477e+03
    ## kitchen_qualGood            .           
    ## kitchen_qualTypical        -9.618135e+03
    ## fireplaces                  6.449021e+03
    ## fireplace_quFair            .           
    ## fireplace_quGood            4.728839e+03
    ## fireplace_quNo_Fireplace    .           
    ## fireplace_quPoor            .           
    ## fireplace_quTypical        -6.465225e+01
    ## exter_qualFair             -1.461139e+04
    ## exter_qualGood              .           
    ## exter_qualTypical          -5.097993e+03
    ## lot_frontage                7.104898e+01
    ## lot_area                    5.607874e-01
    ## longitude                  -1.111611e+04
    ## latitude                    1.771093e+04
    ## misc_val                    .           
    ## year_sold                   .

``` r
y_pred <- predict(lasso_fit, newx = x_test, s = "lambda.min", type = "response")
lasso_mse <- mean(RMSE(y_pred, y_test)^2); lasso_mse
```

    ## [1] 442087599

The test MSE for Lasso model (1SE) is 4.420876^{8}.

### Elastic Net model
